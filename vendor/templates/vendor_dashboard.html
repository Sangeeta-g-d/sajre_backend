{% extends 'vendor_base.html' %}
{% block content %}
{% load custom_filters %}
<link rel="stylesheet" href="/static/assets/mentor/css/mentor-dashboard.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="main-content">
    <!-- Updated Header Section with Export Button -->
    <div class="content-header">
        <div class="header-text">
            <h1>Students Registered via Your Referral Link</h1>
            <p style="margin-left: 20px;">Track and manage all students who joined through your mentorship program</p>
        </div>
        <button class="export-btn">
            <i class="fas fa-download"></i>
            Export CSV
        </button>
    </div>

    <!-- Stats and Actions Container -->
    <div class="stats-actions-container">
        <!-- Stats Cards -->
        <div class="stats-cards">
            <!-- Card 1 -->
            <div class="stat-card">
                <div class="stat-icon blue">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-title">Students Registered</div>
                    <div class="stat-value">{{ referred_students_count }}</div>
                    <div class="stat-details">
                        <span class="stat-label">Via your referrals</span>
                    </div>
                </div>

            </div>



            <!-- Card 3 -->
            <div class="stat-card">
                <div class="stat-icon orange">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-title">Successfully Enrolled</div>
                    <div class="stat-value">{{ enrolled_students_count }}</div>
                    <div class="stat-details">
                        <span class="stat-label">Active in competition</span>
                    </div>
                </div>

            </div>

            <!-- Card 4 -->
            <div class="stat-card">
                <div class="stat-icon red">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-title">Referred Mentors</div>
                    <div class="stat-value">{{ referred_mentors_count }}</div>
                    <div class="stat-details">
                        <span class="stat-label">Active in competition</span>
                    </div>
                </div>

            </div>
        </div>

        <!-- Actions and Tip Section -->
        <div class="actions-tip-section">
            <div class="tip-card">

                <div class="tip-content">
                    <i class="fas fa-exclamation-circle"></i>
                    Follow up with registered students before deadlines!
                </div>
            </div>
        </div>
    </div>



    <div class="category-charts-container">
        <!-- Category Pie Charts Row -->
    <div class="category-charts-row">
    {% if category_data %}
        {% for category in category_data %}
        <div class="category-chart-card">
            <div class="category-chart-card-title">
                {{ category.name|remove_parentheses }} Category
            </div>

            {% if category.total > 0 %}
                <div class="chart-container">
                    <canvas id="{{ category.name|lower }}PieChart" width="90" height="90"></canvas>
                    <div class="chart-stats">
                        <div><strong>Total Users:</strong> {{ category.total }}</div>
                        <div><strong>Registered:</strong> {{ category.total }}</div>
                        <div><strong>Enrolled:</strong> {{ category.enrolled }}</div>
                    </div>
                </div>
            {% else %}
                <div class="no-data-message">
                    <i class="fas fa-chart-pie"></i>
                    <p>No data available for this category</p>
                    <small>Once users join this category, their stats will appear here</small>
                </div>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <div class="no-data-message">
            <i class="fas fa-chart-pie"></i>
            <p>No category data available yet</p>
            <small>Your referral statistics will appear here once students register</small>
        </div>
    {% endif %}
</div>
<!-- {% if request.user.role == "vendor" %}

<div><h1>Vendor</h1></div>

{% endif %} -->
        <!-- Search and Filter Section -->
        <div class="search-filter-section">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search by Name or Category">
            </div>
            <button class="filter-btn">
                <i class="fas fa-filter"></i>
                Filter
            </button>
        </div>
<div class="table-container">
            <table class="students-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll"></th>
                        <th>Student Name</th>
                        <th>Age Group</th>
                        <th>Category</th>
                        <th>Status</th>
                        <th>Registration Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="studentsTableBody">
    {% for user in participants_list %}
<tr>
    <td><input type="checkbox" class="row-checkbox"></td>
    <td>
        <div class="student-info">
            <img src="{{ user.participant_profile.photo.url|default:'https://via.placeholder.com/40' }}" 
                 alt="{{ user.full_name }}" class="student-avatar">
            <div>
                <div class="student-name">{{ user.full_name }}</div>
                <div class="student-email">{{ user.email }}</div>
            </div>
        </div>
    </td>
    <td>
        {% if user.participant and user.participant.category.age_min and user.participant.category.age_max %}
            {{ user.participant.category.age_min }}-{{ user.participant.category.age_max }}
        {% else %}
            N/A
        {% endif %}
    </td>
    <td>
        {% if user.participant and user.participant.category %}
            <span class="category">{{ user.participant.category.name }}</span>
        {% else %}
            <span class="category">N/A</span>
        {% endif %}
    </td>
    <td>
        {% if user.participant and user.participant.has_paid %}
            <span class="status enrolled">Enrolled</span>
        {% else %}
            <span class="status not-enrolled">Not Enrolled</span>
        {% endif %}
    </td>
    <td>{{ user.date_joined|date:"d M, Y" }}</td>
    <td>
        <button class="action-btn view-btn">
            <i class="fas fa-eye"></i> View
        </button>
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="7">No participants found.</td>
</tr>
{% endfor %}

</tbody>

            </table>
        </div>
        <!-- Chart.js CDN -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Initialize charts with dynamic data
            const chartOptions = {
                responsive: false,
                plugins: {
                    legend: { display: false }
                }
            };

            {% for category in category_data %}
            new Chart(document.getElementById('{{ category.name|lower }}PieChart'), {
                type: 'pie',
                data: {
                    labels: ['Enrolled', 'Not Enrolled'],
                    datasets: [{
                        data: [{{ category.enrolled }}, {{ category.not_enrolled }}],
                backgroundColor: ['#f95d5d', '#66deb4']
            }]
        },
                options: chartOptions
    });
            {% endfor %}
        </script>


    </div>
</div>
<script src="/static/assets/mentor/js/mentor-dashboard.js"></script>
{% endblock %}