{% extends 'admin_base.html' %}
{% load static %}
{% block content %}

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="p-6 bg-gray-100 min-h-screen">
    <h1 class="text-3xl font-bold mb-6">Admin Dashboard</h1>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-8">
        <div class="p-6 bg-white rounded-xl shadow-md text-center">
            <h2 class="text-xl font-semibold">Participants</h2>
            <p class="text-3xl font-bold text-blue-600">{{ total_participants }}</p>
        </div>
        <div class="p-6 bg-white rounded-xl shadow-md text-center">
            <h2 class="text-xl font-semibold">Mentors</h2>
            <p class="text-3xl font-bold text-green-600">{{ total_mentors }}</p>
        </div>
        <div class="p-6 bg-white rounded-xl shadow-md text-center">
            <h2 class="text-xl font-semibold">Vendors</h2>
            <p class="text-3xl font-bold text-purple-600">{{ total_vendors }}</p>
        </div>
        <div class="p-6 bg-white rounded-xl shadow-md text-center">
            <h2 class="text-xl font-semibold">Courses</h2>
            <p class="text-3xl font-bold text-yellow-600">{{ total_courses }}</p>
        </div>
        <div class="p-6 bg-white rounded-xl shadow-md text-center">
            <h2 class="text-xl font-semibold">Categories</h2>
            <p class="text-3xl font-bold text-pink-600">{{ total_categories }}</p>
        </div>
    </div>

    <!-- Revenue Summary -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="p-6 bg-white rounded-xl shadow-md">
            <h2 class="text-xl font-semibold mb-4">Revenue</h2>
            <p class="text-2xl font-bold text-indigo-600">₹ {{ total_revenue|floatformat:2 }}</p>
            <p class="text-gray-500">This Month: ₹ {{ monthly_revenue|floatformat:2 }}</p>
        </div>

        <!-- Revenue Chart -->
        <div class="p-6 bg-white rounded-xl shadow-md">
            <h2 class="text-xl font-semibold mb-4">Revenue Trend</h2>
            <canvas id="revenueChart"></canvas>
        </div>
    </div>

    <!-- Recent Payments -->
    <div class="p-6 bg-white rounded-xl shadow-md">
        <h2 class="text-xl font-semibold mb-4">Recent Payments</h2>
        <table class="w-full border-collapse">
            <thead>
                <tr class="bg-gray-200 text-left">
                    <th class="p-2">Participant</th>
                    <th class="p-2">Amount</th>
                    <th class="p-2">Date</th>
                    <th class="p-2">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in recent_payments %}
                <tr class="border-b">
                    <td class="p-2">{{ payment.participant.user.full_name }}</td>
                    <td class="p-2">₹ {{ payment.amount|floatformat:2 }}</td>
                    <td class="p-2">{{ payment.payment_date|date:"d M, Y H:i" }}</td>
                    <td class="p-2">
                        <span class="px-2 py-1 text-sm rounded bg-green-100 text-green-700">
                            {{ payment.status }}
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="4" class="p-2 text-center">No payments yet</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Chart Script -->
<script>
    const ctx = document.getElementById('revenueChart').getContext('2d');
    const revenueData = {
        labels: [{% for r in revenue_trend %}"{{ r.month }}",{% endfor %}],
        datasets: [{
            label: 'Revenue (₹)',
            data: [{% for r in revenue_trend %}{{ r.total }},{% endfor %}],
            backgroundColor: 'rgba(99, 102, 241, 0.2)',
            borderColor: 'rgba(99, 102, 241, 1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4
        }]
    };
    new Chart(ctx, {
        type: 'line',
        data: revenueData,
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>

{% endblock %}
